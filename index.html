 <!DOCTYPE html>
<html>
<head>
    <title>INCH LSZH</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="INCH_Dark.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=B612+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=B612:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet"> 
    <link rel="icon" href="favicon.ico" type="image/x-icon"/>
</head>
    <body>
        <div class="flex_container">
            <div class="irl_part">
                <div class="lateral_arrangement">
                    <div class="airport_display">
                        <div class="major_button_box">
                            <div class="major_button_active">
                                <p>TIP</p>
                            </div>
                            <div class="major_button">
                                <p>ATIS</p>
                            </div>
                            <div class="major_button">
                                <p>MET</p>
                            </div>
                            <div class="major_button_unavail">
                                <p>WX</p>
                            </div>
                            <div class="major_button">
                                <p>INFO</p>
                            </div>
                            <div class="major_button">
                                <p>DAM</p>
                            </div>
                        </div>
                        <div class="info_strip">
                            <div class="clock">
                                <p><span id="UTC Date" style="font-size: 48px"></span> <span id="UTC Date Hours"></span>:<span id="UTC Date Minutes" style="font-size: 48px"></span>:<span id="UTC Date Seconds"></span></p>
                            </div>
                            <div class="atis_boxes">
                                <div class="dep_atis" onmouseover="atisToDep()">
                                    <p>DEP</p>
                                    <div class="on_air_indicator" id="dep_atis_on_air"></div>
                                    <div class="atis_runtime" id="dep_atis_runtime"></div>
                                    <p><span id="depAtisFirst" style="font-size: 80px"></span><span id="depAtisRest" style="font-size: 34px"></span></p>
                                </div>
                                <div class="arr_atis" onmouseover="atisToArr()">
                                    <p>ARR</p>
                                    <div class="on_air_indicator" id="arr_atis_on_air"></div>
                                    <div class="atis_runtime" id="arr_atis_runtime"></div>
                                    <p><span style="font-size: 80px" id="arrAtisFirst"></span><span style="font-size: 34px" id="arrAtisRest"></span></p>
                                </div>
                            </div>
                            <div class="decoded_info" id="decoded_info">
                                <table>
                                    <tr>
                                        <th>Rwy:</th>
                                        <th id="approach_type"></th>
                                    </tr>
                                    <tr>
                                        <th>Loc Rep:</th>
                                        <th id="metarLocRep"></th>
                                    </tr>
                                    <tr>
                                        <th>Wind:</th>
                                        <th id="metarWind"></th>
                                    </tr>
                                    <tr>
                                        <th>Vis:</th>
                                        <th id="metarVis"></th>
                                    </tr>
                                    <tr>
                                        <th>Weather:</th>
                                        <th id="metarWxString"></th>
                                    </tr>
                                    <tr>
                                        <th>Clouds:</th>
                                        <th id="metarSkyCondition"></th>
                                    </tr>
                                    <tr>
                                        <th>Temp:</th>
                                        <th id="metarTempDp"></th>
                                    </tr>
                                    <tr>
                                        <th>Trend:</th>
                                        <th id="metarTrend"></th>
                                    </tr>
                                </table>
                            </div>
                            <div class="TRL_QNH">
                                <table>
                                    <tr>
                                        <th>TRL</th>
                                        <th id="TRL"></th>
                                        <th style="padding-left: 50px">QNH</th>
                                        <th id="metarQnh"></th>
                                    </tr>
                                </table>
                            </div>
                            <div class="Remote_Wind">
                                <table>
                                    <tr>
                                        <th>Hörnli</th>
                                        <td id="hoernliTime"></td>
                                        <th id="hoernliWind"></th>
                                        <td>max:</td>
                                        <th id="hoernliGust"></th>
                                        <th id="hoernliTemp"></th>
                                    </tr>
                                    <tr>
                                        <th>Lägern</th>
                                        <td id="laegernTime"></td>
                                        <th id="laegernWind"></th>
                                        <td>max:</td>
                                        <th id="laegernGust"></th>
                                        <th id="laegernTemp"></th>
                                    </tr>
                                </table>
                            </div>
                            <div class="Day_Night">
                                <table>
                                    <tr>
                                        <th>Day</th>
                                        <td id="boct"></td>
                                        <th>Night</th>
                                        <td id="eoct"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="graphical_representation">
                            <img src="runway_layout.png"  class="arrow_runway_layout" alt="Runway Layout" style="width: 641px; visibility: visible">
                            <img src="arr_rwy_14.png" class="arrow_runway_layout" id="arr_rwy_14">
                            <img src="arr_rwy_16.png" class="arrow_runway_layout" id="arr_rwy_16">
                            <img src="arr_rwy_28.png" class="arrow_runway_layout" id="arr_rwy_28">
                            <img src="arr_rwy_34.png" class="arrow_runway_layout" id="arr_rwy_34">
                            <img src="dep_rwy_10.png" class="arrow_runway_layout" id="dep_rwy_10">
                            <img src="dep_rwy_16.png" class="arrow_runway_layout" id="dep_rwy_16">
                            <img src="dep_rwy_28.png" class="arrow_runway_layout" id="dep_rwy_28">
                            <img src="dep_rwy_32.png" class="arrow_runway_layout" id="dep_rwy_32">
                            <img src="dep_rwy_34.png" class="arrow_runway_layout" id="dep_rwy_34">
                            <div class="Wind_Rwy14" id="Wind_Rwy14"></div>
                            <img src="Arrow.png" class="Wind_Arrow_Rwy14" id="Wind_Arrow_Rwy14" style="width: 20px">
                            <div class="Wind_Rwy10" id="Wind_Rwy10"></div>
                            <img src="Arrow.png" class="Wind_Arrow_Rwy10" id="Wind_Arrow_Rwy10" style="width: 20px">
                            <div class="Wind_Rwy32" id="Wind_Rwy32"></div>
                            <img src="Arrow.png" class="Wind_Arrow_Rwy32" id="Wind_Arrow_Rwy32" style="width: 20px">
                        </div>
                </div>
                    <div class="right_side_menu">
                        <div class="right_side_controls">
                            <img class="speaker_icon" src="Speaker_Icon.png">
                            <img class="clock_icon" src="Clock_Icon.png">
                            <img class="status_indicator" src="Green_Circle_Icon.png">
                        </div>
                        <div class="own_frequency" id="own_frequency"></div>
                    </div>
                </div>
                <div class="bottom_info_bar">
                    <div class="para_jumper_status">
                        <div class="status_box_inactive">
                            <table class="para_jumper_table">
                                <tr>
                                    <td>Beromünster</td>
                                    <td>4272</td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="para_jumper_table">
                                <tr>
                                    <td>Buttwil</td>
                                    <td>4271</td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="para_jumper_table">
                                <tr>
                                    <td>Rottweil</td>
                                    <td>0025</td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="para_jumper_table">
                                <tr>
                                    <td>Schwenningen</td>
                                    <td>0076</td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="para_jumper_table">
                                <tr>
                                    <td>Sitterdorf</td>
                                    <td>4273</td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="para_jumper_table">
                                <tr>
                                    <td>Speck</td>
                                    <td>6307</td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="para_jumper_table">
                                <tr>
                                    <td>Triengen</td>
                                    <td>4270</td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="para_jumper_table">
                                <tr>
                                    <td>Stahringen</td>
                                    <td>6306</td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="para_jumper_table">
                                <tr>
                                    <td>Pfullendorf</td>
                                    <td>6306</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="glider_sector_status">
                        <div class="status_box_inactive">
                            <table class="glider_sector_table">
                                <tr>
                                    <td>Albis</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="glider_sector_table">
                                <tr>
                                    <td>Bachtel E</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="glider_sector_table">
                                <tr>
                                    <td>Bachtel W</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="glider_sector_table">
                                <tr>
                                    <td>Schaffhausen E</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="glider_sector_table">
                                <tr>
                                    <td>Schaffhausen S</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="glider_sector_table">
                                <tr>
                                    <td>Schaffhausen W</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="glider_sector_table">
                                <tr>
                                    <td>Winterthur E</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                        <div class="status_box_inactive">
                            <table class="glider_sector_table">
                                <tr>
                                    <td>Winterthur W</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="airspace_status">
                        <div class="mil_airspace_status">
                            <div class="mil_addc">
                                <div class="status_box_inactive">
                                    <table class="mil_airspace_table">
                                        <tr>
                                            <td>MIL</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="status_box_inactive">
                                    <table class="mil_airspace_table">
                                        <tr>
                                            <td>ADDC</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            <div class="dub_emm">
                                <div class="status_box_inactive">
                                    <table class="mil_airspace_table">
                                        <tr>
                                            <td>DUB</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="status_box_inactive">
                                    <table class="mil_airspace_table">
                                        <tr>
                                            <td>EMM</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="civ_airspace_status">
                            <div class="status_box_inactive">
                                <table class="civ_airspace_table">
                                    <tr>
                                        <td>CTR 2</td>
                                        <td></td>
                                    </tr>
                                </table>
                            </div>
                            <div class="status_box_inactive">
                                <table class="civ_airspace_table">
                                    <tr>
                                        <td>TMA 14/15</td>
                                        <td></td>
                                    </tr>
                                </table>
                            </div>
                            <div class="status_box_inactive">
                                <table class="civ_airspace_table">
                                    <tr>
                                        <td style="text-align: center; width: 200px;">A9 140+</td>
                                    </tr>
                                </table>
                            </div>
                            <p style="height: 21px"></p>
                            <div class="status_box_inactive">
                                <table class="civ_airspace_table">
                                    <tr>
                                        <td style="text-align: center; width: 200px;">ED-R150 NLFS</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="airport_status">
                        <div class="lateral_arrangement">
                            <div class="crosscoupling_status">
                                <div class="status_box_inactive" style="margin-bottom: 6px;">
                                    <table class="crosscoupling_table">
                                        <tr>
                                            <td>Delta</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="status_box_inactive" style="margin-bottom: 6px;">
                                    <table class="crosscoupling_table">
                                        <tr>
                                            <td>FIC</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="status_box_inactive">
                                    <table class="crosscoupling_table">
                                        <tr>
                                            <td>LSZB</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            <div class="meteo_status">
                                <div class="lateral_arrangement">
                                    <div class="meteo_left">
                                        <div class="status_box_inactive" id="imc_status">
                                            <table class="meteo_table_left">
                                                <tr>
                                                    <td>IMC</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_inactive" id="lvp_status">
                                            <table class="meteo_table_left">
                                                <tr>
                                                    <td>LVP</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_inactive" id="ndvo_status">
                                            <table class="meteo_table_left">
                                                <tr>
                                                    <td>NDVO</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_inactive">
                                            <table class="meteo_table_left">
                                                <tr>
                                                    <td>PRIDEP</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_inactive">
                                            <table class="meteo_table_left">
                                                <tr>
                                                    <td>RS</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="meteo_right">
                                        <div class="status_box_inactive">
                                            <table class="meteo_table_right">
                                                <tr>
                                                    <td>De-Icing</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_inactive">
                                            <table class="meteo_table_right">
                                                <tr>
                                                    <td>Extd Slots</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_inactive">
                                            <table class="meteo_table_right">
                                                <tr>
                                                    <td>Low Temp</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_inactive">
                                            <table class="meteo_table_right">
                                                <tr>
                                                    <td>ADC 2</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_inactive">
                                            <table class="meteo_table_right">
                                                <tr>
                                                    <td>Man Blocking</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="runway_status">
                            <div class="left_half">
                                <div class="approach_status">
                                    <div class="lateral_arrangement">
                                        <div class="status_box_active">
                                            <table class="ils_table">
                                                <tr>
                                                    <td>CAT 3<br>14</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_active">
                                            <table class="ils_table">
                                                <tr>
                                                    <td>CAT 3<br>16</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="status_box_active">
                                        <table class="runway_config_table">
                                            <tr>
                                                <td>DEP<br><span id="dep_rwy_status"></span></td>
                                            </tr>
                                        </table>                                        
                                    </div>
                                </div>
                                <div class="departure_runway">
                                </div>
                            </div>
                            <div class="right_half">
                                <div class="approach_status">
                                    <div class="lateral_arrangement">
                                        <div class="status_box_active">
                                            <table class="ils_table">
                                                <tr>
                                                    <td>CAT 1<br>28</td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="status_box_active">
                                            <table class="ils_table">
                                                <tr>
                                                    <td>CAT 1<br>34</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="status_box_active">
                                        <table class="runway_config_table">
                                            <tr>
                                                <td>ARR<br><span id="arr_rwy_status"></span></td>
                                            </tr>
                                        </table>                                        
                                    </div>
                                <div class="arrival_runway">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        <script>
            const apt = "lszh";
            const runways = {rwy10:{Course:094,Departures:true,Arrivals:false,bestApproach:"NIL",ceilingMinima:"N/A",visMinima:"N/A"},
                          rwy14:{Course:135,Departures:false,Arrivals:true,bestApproach:"ILS",ceilingMinima:0,visMinima:0},
                          rwy16:{Course:153,Departures:true,Arrivals:true,bestApproach:"ILS",ceilingMinima:0,visMinima:0},
                          rwy28:{Course:274,Departures:true,Arrivals:true,bestApproach:"ILS",ceilingMinima:900,visMinima:4300},
                          rwy32:{Course:314,Departures:true,Arrivals:false,bestApproach:"NIL",ceilingMinima:"N/A",visMinima:"N/A"},
                          rwy34:{Course:333,Departures:true,Arrivals:true,bestApproach:"ILS",ceilingMinima:300,visMinima:750}}
            let globalTrl = 70;
            let globalWeather = {windDir:0,windSpeed:0,ceiling:9999,vis:9999,qnh:1013,rvr:2001};
            let runwayConcept = {depRwy:[0],arrRwy:[0],conceptName:"NIL",isNDVO:false};
            let vatsimCid = 1268472;
            let globalRvr = [];
            let shownAtis = "Arr";
            
            function getATISByICAO(icao) {
                return vatsim_atis.filter(
                    function(vatsim_atis) {
                        return vatsim_atis.callsign == icao + "_ATIS" 
                    }
                );
            }
            
            const atisToDep = () => {
                shownAtis = "Dep";
                updateAtis();
            };
            const atisToArr = () => {
                shownAtis = "Arr";
                updateAtis();
            };
            
            function UTCDateTime() {
                var UTC_Date_String = new String();
                var Months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                var date_time = new Date();
                var UTCDay = date_time.getUTCDate().toString().padStart(2,'0');
                var UTCMonth = Months[date_time.getUTCMonth()];
                var UTCHour = date_time.getUTCHours().toString().padStart(2,'0');
                var UTCMinute = date_time.getUTCMinutes().toString().padStart(2,'0');
                var UTCSecond = date_time.getUTCSeconds().toString().padStart(2,'0');
                UTC_Date_String = UTCDay.concat(" " ,UTCMonth);
                document.getElementById("UTC Date").innerHTML = UTC_Date_String;
                document.getElementById("UTC Date Hours").innerText = UTCHour.toString();
                document.getElementById("UTC Date Minutes").innerHTML = UTCMinute.toString();
                document.getElementById("UTC Date Seconds").innerHTML = UTCSecond.toString();
            }
            setInterval(UTCDateTime, 500);
            UTCDateTime();
            
            const fetchCivilTwilight = async () => {
                try {
                    const response = await fetch ("https://api.sunrise-sunset.org/json?lat=47.458345791&lng=8.548137746");
                    const { results } = await response.json();
                    return [results.civil_twilight_begin, results.civil_twilight_end];
                } catch (error) {
                    throw new Error(error);
                }
            };
            
            const formatTime = (time) => {
                const splitTime = time.split(":");
                const amPm = splitTime[2].slice(3,5);
                if (amPm === "PM") {
                    const hours24h = String(Number(splitTime[0]) + 12);
                    return hours24h.concat("h",splitTime[1]);
                } else {
                    return splitTime[0].padStart(2,0).concat("h",splitTime[1]);
                };                
            }
            
            const updateCivilTwilight = async () => {
                const elboct = document.getElementById("boct");
                const eleoct = document.getElementById("eoct");
                const civilTwilight  = await fetchCivilTwilight();
  
                if (civilTwilight) {
                    const beginningOfCivilTwilight = civilTwilight[0];
                    const endOfCivilTwilight = civilTwilight[1];
                    elboct.innerText = formatTime(beginningOfCivilTwilight);
                    eleoct.innerText = formatTime(endOfCivilTwilight);
                }
            }
            setInterval(() => updateCivilTwilight(), 3600000);
            updateCivilTwilight();
            
            
            const fetchMetar = async () => {
                const respose = await fetch("https://api.paganini.cloud/LSZH.xml");
                const data = await respose.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(data,"application/xml");
                return xml;
            }; 
            
            const windFormatter = (rawWindDir, rawWindSpeed) => {
                if (Number(rawWindSpeed) === 0){
                    return "CALM"
                } else if (Number(rawWindDir) === 0) {
                    const windVariableText = "VARIABLE, ";
                    return windVariableText.concat(rawWindSpeed, "KT");
                } else {
                    const formattedWind = String(rawWindDir).padStart(3,0).concat(" DEG, ", rawWindSpeed, "KT");
                    return formattedWind;
                };
            };
            
            const visFormatter = (rawVis) => {
                if (rawVis > 9501) {
                    return "GREATER THAN 10KM"
                } else {
                    const roundedVis = String(Math.round(rawVis / 50) * 50);
                    return roundedVis.concat("M");
                }
            };
            
            const undefinedChecker = (xml, xmlElement) => {
                if (xml.getElementsByTagName(xmlElement)[0] === undefined) {
                    return true;
                } else {
                    return false;
                };
            };
            
            const wxStringFormatter = (xml) => {
                if (undefinedChecker(xml,"wx_string")) {
                    return "NIL";
                } else {
                    return xml.getElementsByTagName("wx_string")[0].textContent;
                };
            };
            
            const cavokChecker = (skyCover, cloudBase) => {
                if (skyCover === "CAVOK") {
                    return "CAVOK";
                } else if (skyCover === "OVX") {
                    return "VERT VIS ".concat(cloudBase,"FT");
                } else {
                    return skyCover.concat(" ", cloudBase, "FT");
                };
            };
            
            const skyConditionFormatter = (xml) =>{
                const skyConditionArray = xml.getElementsByTagName("sky_condition");
                var skyConditionString = "";
                for (var i = 0; i < skyConditionArray.length; i++) {
                    const skyCoverElement = skyConditionArray[i].getAttribute("sky_cover");
                    const cloudBaseElement = skyConditionArray[i].getAttribute("cloud_base_ft_agl");
                    let skyConditionElement = "";
                    if (skyCoverElement === "CLR") {
                        skyConditionElement = "NIL SIGNIFICANT CLOUDS";
                    } else {
                        skyConditionElement = cavokChecker(skyCoverElement, cloudBaseElement);
                    };
                    if (i === 0) {
                        skyConditionString = skyConditionString.concat(skyConditionElement);
                    } else {
                        skyConditionString = skyConditionString.concat("<br>",skyConditionElement);
                    };
                };
                return skyConditionString;
            };
            
            const numberSigner = (numberInput, padValue) => {
                const paddedNumber = String(Math.abs(numberInput)).padStart(padValue,0);
                if (numberInput < 0) {
                    return "-".concat(paddedNumber);
                } else {
                    return "+".concat(String(numberInput).padStart(padValue,0));
                };
            };
            
            const tempDpFormatter = (xml) => {
                const temp = numberSigner(Math.round(Number(xml.getElementsByTagName("temp_c")[0].textContent)),2);
                const dp = numberSigner(Math.round(Number(xml.getElementsByTagName("dewpoint_c")[0].textContent)),2);
                return temp.concat("/", dp);
            };
            
            const qnhFormatter = (xml) => {
                const altim = Number(xml.getElementsByTagName("altim_in_hg")[0].textContent);
                const qnh = Math.round(altim * 33.864);
                return qnh;
            };
            
            const trendFinder = (metarString) => {
                const indexOfTrendArray = [metarString.search("NOSIG"),
                                      metarString.search("TEMPO"),
                                      metarString.search("BECMG"),
                                      metarString.search(/FM[0-9]{2,}/),
                                      metarString.search(/TL[0-9]{2,}/),
                                      metarString.search(/AT[0-9]{2,}/)];
                const indexOfRmk = metarString.search("RMK");
                var indexOfTrend = 9999;
                for (var i = 0; i < indexOfTrendArray.length; i++) {
                    if (indexOfTrendArray[i] < indexOfTrend && indexOfTrendArray[i] > -1) {
                        indexOfTrend = indexOfTrendArray[i];
                    } 
                };
                if (indexOfRmk < 0) {
                    return metarString.slice(indexOfTrend);
                } else {
                    return metarString.slice(indexOfTrend,indexOfRmk);
                };
            };
            
            const rvrParser = (metarString) =>  {
                const rvrArray = metarString.match(/R[0-9]{2}[LCR]?\/[MP]?[0-9]{4}[UND] ?/gi);
                let parsedRvr = [];
                for (let i = 0; i < rvrArray.length; i++) {
                    const runway = rvrArray[i].split("/")[0].slice(1,);
                    const rvr = rvrArray[i].split("/")[1].slice(0,-2);
                    const trend = rvrArray[i].split("/")[1].slice(-2,-1);
                    parsedRvr[i] = {"runway":runway,"rvr":rvr,"trend":trend};
                };
                let numericRVR = 2001;
                for (let i = 0; i < parsedRvr.length; i++) {
                    if (parsedRvr[i].rvr.startsWith("M")) {
                        numericRVR = 0;
                    } else if (parsedRvr[i].rvr.startsWith("P")) {
                    } else if (Number(parsedRvr[i].rvr) < numericRVR) {
                        numericRVR = Number(parsedRvr[i].rvr);
                    };
                };
                globalRvr = parsedRvr;
                globalWeather.rvr = numericRVR;
            };
            
            const updateMetar = async () => {
                const locRepEl = document.getElementById("metarLocRep");
                const windEl = document.getElementById("metarWind");
                const visEl = document.getElementById("metarVis");
                const wxStringEl = document.getElementById("metarWxString");
                const skyConditionEl = document.getElementById("metarSkyCondition");
                const TempDpEl = document.getElementById("metarTempDp");
                const qnhEl = document.getElementById("metarQnh");
                const trendEl = document.getElementById("metarTrend");
                const xmlMetar = await fetchMetar();
                const rawTextMetar = xmlMetar.getElementsByTagName("raw_text");
                const metarString = rawTextMetar[0].textContent;
                const locator = metarString.slice(0,4);
                const metarDate = metarString.slice(5,7);
                const metarHours = metarString.slice(7,9);
                const metarMinutes = metarString.slice(9,11);
                const locRep = locator.concat(" Date ", metarDate, " ", metarHours, "h", metarMinutes);
                const metarWindDir = xmlMetar.getElementsByTagName("wind_dir_degrees")[0].textContent;
                const metarWindSpeed = xmlMetar.getElementsByTagName("wind_speed_kt")[0].textContent;
                const metarVis = Number(xmlMetar.getElementsByTagName("visibility_statute_mi")[0].textContent)*1609;
                const formattedVis = visFormatter(metarVis);
                const wind = windFormatter(metarWindDir, metarWindSpeed);
                const wxString = wxStringFormatter(xmlMetar);
                const skyCondition = skyConditionFormatter(xmlMetar);
                const tempDp = tempDpFormatter(xmlMetar);
                const qnh = qnhFormatter(xmlMetar);
                if (qnh > 1012) {
                    qnhEl.style = "color: lightgreen";
                } else {
                    qnhEl.style = "color: #EFE26A"
                }
                if (metarString.match(/R[0-9]{2}[LCR]?\/[MP]?[0-9]{4}[UND]? /gi) != null) {
                    rvrParser(metarString);
                } else {
                    globalRvr = [];
                    globalWeather.rvr = 2001;
                };
                globalWeather.windDir = Number(metarWindDir);
                globalWeather.windSpeed = Number(metarWindSpeed);
                globalWeather.qnh = qnh;
                globalWeather.vis = metarVis;
                ceilingDeterminer(xmlMetar);
                const trend = trendFinder(metarString);
                locRepEl.innerText = locRep;
                windEl.innerText = wind;                
                visEl.innerText = formattedVis;
                wxStringEl.innerText = wxString;
                skyConditionEl.innerHTML = skyCondition;
                TempDpEl.innerText = tempDp;
                qnhEl.innerText = qnh;
                trendEl.innerText = trend;
            };
            setInterval(() => updateMetar(), 59500);
            updateMetar();
            
            const windComponentCalculator = (windDir, windSpeed, course) =>{
                const headWindComponent = Math.cos((Number(course) - windDir) * Math.PI / 180) * Number(windSpeed);
                return headWindComponent;
            };
            
            const ceilingDeterminer = (xml) => {
                const skyConditionCollection = xml.getElementsByTagName("sky_condition");
                let ceiling = 9999;
                for (let i = 0; i < skyConditionCollection.length; i++) {
                    if (skyConditionCollection[i].getAttribute("sky_cover") === "BKN" || skyConditionCollection[i].getAttribute("sky_cover") === "OVC" || skyConditionCollection[i].getAttribute("sky_cover") === "OVX") {
                        if (skyConditionCollection[i].getAttribute("cloud_base_ft_agl") < ceiling) {
                            ceiling = Number(skyConditionCollection[i].getAttribute("cloud_base_ft_agl"));
                        }
                    }
                }
                globalWeather.ceiling = ceiling;
            }
            
            const noAtisRunwayConceptDeterminer = async () => {
                const date = new Date();
                let depRwy;
                let arrRwy;
                let conceptName;
                let isNDVO = false;
                const time = {Day:date.getDay(), Hour:date.getHours()};
                if (((time.Day === 0 || time.Day === 6) && time.Hour < 9) || time.Hour < 6) {
                    depRwy = [32];
                    arrRwy = [34];
                    conceptName = "DVO 34";
                    if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy34.Course) < -5) {
                        arrRwy = [28];
                        conceptName = "DVO 28";
                        if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy28.Course) < -5 || globalWeather.vis < runways.rwy28.visMinima || globalWeather.ceiling < runways.rwy28.ceilingMinima) {
                            arrRwy = [14];
                            depRwy = [28,16];
                            conceptName = "Standard NDVO";
                            isNDVO = true;
                            if (time.Hour < 7 || time.Hour > 22) {
                                depRwy = [34];
                                conceptName = "Sackbahnhof";
                                isNDVO = true;
                            } else if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy28.Course) < -5) {
                                depRwy = [10,16];
                                conceptName = "Bise NDVO";
                                isNDVO = true;
                            };
                        };
                    };
                } else if (((time.Day === 0 || time.Day === 6) && time.Hour > 19) || time.Hour > 20) {
                    depRwy = [32];
                    arrRwy = [28];
                    conceptName = "DVO 28";
                    if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy28.Course) < -5 || globalWeather.vis < runways.rwy28.visMinima || globalWeather.ceiling < runways.rwy28.ceilingMinima) {
                        depRwy = [32];
                        arrRwy = [34];
                        conceptName = "DVO 34";
                        if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy34.Course) < -5 || globalWeather.vis < runways.rwy28.visMinima || globalWeather.ceiling < runways.rwy28.ceilingMinima) {
                            arrRwy = [14];
                            depRwy = [28,16];
                            conceptName = "Standard NDVO";
                            isNDVO = true;
                            if (time.Hour < 7 || time.Hour > 22) {
                                depRwy = [34];
                                conceptName = "Sackbahnhof";
                                isNDVO = true;
                            } else if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy28.Course) < -5) {
                                depRwy = [10];
                                conceptName = "Bise NDVO";
                                isNDVO = true;
                            };
                        };
                    }
                } else {
                    depRwy = [28,16];
                    arrRwy = [14];
                    conceptName = "Standard";
                    if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy14.Course) < -5) {
                        depRwy = [32];
                        arrRwy = [28];
                        conceptName = "Wind 28";
                        if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy28.Course < -5 || globalWeather.vis < runways.rwy28.visMinima || globalWeather.ceiling < runways.rwy28.ceilingMinima)) {
                            arrRwy = [34];
                            conceptName = "Wind 34";
                        }
                    };
                    if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy28.Course) < -5) {
                        depRwy = [10,16];
                        conceptName = "Bise";
                        if (windComponentCalculator(globalWeather.windDir,globalWeather.windSpeed,runways.rwy14.Course) < -5) {
                            depRwy = [32];
                            arrRwy = [34];
                            runwayConcept = "Wind 34";
                        }
                    }
                };
                runwayConcept = {depRwy:depRwy,arrRwy:arrRwy,conceptName:conceptName,isNDVO:isNDVO};
            };
            
            const findRunwaysInAtis = (rawATIS) => {
                const firstArrRwyIndexWithApch = rawATIS.search(/APPROACH RUNWAY/i);
                const firstArrRwyIndexNoApch = rawATIS.search(/ARRIVAL RUNWAY/i);
                const firstDepRwyIndex = rawATIS.search(/DEPARTURE RUNWAY/i);
                const lastRunwayFinderRe = /and [0-9]{2}[LCR]?\s/gi;
                const lastArrRwyIndex = rawATIS.slice(0,firstDepRwyIndex).search(lastRunwayFinderRe);
                const lastDepRwyIndex = rawATIS.slice(firstDepRwyIndex).search(lastRunwayFinderRe) + firstDepRwyIndex;
                let depRwy = [];
                let arrRwy = [];
                if (firstArrRwyIndexWithApch > -1) {
                    if (lastArrRwyIndex > -1) {
                        arrRwy = rawATIS.slice(firstArrRwyIndexWithApch + 16, lastArrRwyIndex + 7).replace(/ and /gi," ").split(" ");                    
                    } else {
                        arrRwy = rawATIS.slice(firstArrRwyIndexWithApch + 16, firstArrRwyIndexWithApch + 19).split(" ");
                    }
                } else if (firstArrRwyIndexNoApch > -1) {
                    if (lastArrRwyIndex > -1) {
                        arrRwy = rawATIS.slice(firstArrRwyIndexNoApch + 15, lastArrRwyIndex + 7).replace(/ and /gi," ").split(" ");
                    } else {
                        arrRwy = rawATIS.slice(firstArrRwyIndexNoApch + 15, firstArrRwyIndexNoApch + 18).split(" ");
                    };
                };
                if (firstDepRwyIndex > -1) {
                    if (lastDepRwyIndex > firstDepRwyIndex) {
                        depRwy = rawATIS.slice(firstDepRwyIndex + 17, lastDepRwyIndex + 7).replace(/ and /gi," ").split(" ");
                    } else {
                        depRwy = rawATIS.slice(firstDepRwyIndex + 17, firstDepRwyIndex + 20).split(" ");
                    };
                };
                if (arrRwy[arrRwy.length - 1] === "") {
                            arrRwy.pop();
                };
                if (depRwy[depRwy.length - 1] === "") {
                            depRwy.pop();
                };
                const conceptName = conceptNameFinder(arrRwy,depRwy).conceptName;
                const isNdvo = conceptNameFinder(arrRwy,depRwy).isNdvo;
                /* console.log({"Raw ATIS": rawATIS, "Approach Runway Index": firstArrRwyIndexWithApch, "Arrival Runway Index": firstArrRwyIndexNoApch, "Arrival Runway End Index":lastArrRwyIndex, "Departure Runway Index": firstDepRwyIndex, "Departure Runway End Index": lastDepRwyIndex, "Departure Runways":depRwy}); */
                runwayConcept = {depRwy:depRwy,arrRwy:arrRwy,conceptName:conceptName,isNDVO:isNdvo};
            };

            const conceptNameFinder = (arrRwy,depRwy) => {
                let conceptName = "Not Found!";
                let isNdvo = false;
                let isDvoTime = false;
                const date = new Date();
                const time = {Day:date.getDay(), Hour:date.getHours()};
                if ((((time.Day === 0 || time.Day === 6) && time.Hour < 9) || time.Hour < 6) || (((time.Day === 0 || time.Day === 6) && time.Hour > 19) || time.Hour > 20)) {
                    isDvoTime = true;
                };
                if (arrRwy.includes("14") || arrRwy.includes(14)) {
                    if (depRwy.includes("28") || depRwy.includes(28)) {
                        conceptName="Standard";
                    } else if (depRwy.includes("10") || depRwy.includes(10)){
                        conceptName="Bise";
                    } else if (depRwy.includes("34") || depRwy.includes(34)){
                        conceptName="Sackbahnhof";
                    };                    
                    if (isDvoTime) {
                        isNdvo = true;
                        if (conceptName === "Standard") {
                            conceptName = "Standard NDVO";
                        } else if (conceptName === "Bise") {
                            conceptName = "Bise NDVO"
                        };
                    };
                };
                if ((arrRwy.includes("28") || arrRwy.includes(28)) && (depRwy.includes("32") || depRwy.includes(32))) {
                    if (isDvoTime) {
                        conceptName = "DVO 28"
                    } else {
                        conceptName = "Wind 28"
                    }
                };
                if ((arrRwy.includes("34") || arrRwy.includes(34)) && (depRwy.includes("32") || depRwy.includes(32))) {
                    if (isDvoTime) {
                        conceptName = "DVO 34"
                    } else {
                        conceptName = "Wind 34"
                    }
                };
                return {conceptName:conceptName,isNdvo:isNdvo};
            };
            
            const natoRest = async (letter) => {
                const natoAlphabetTable = await fetch (`NATO_Alphabet.json`);
                const { Alphabet } = await natoAlphabetTable.json();
                if (letter === ""){
                    return "";
                } else {
                    const natoLetterTable = Alphabet.find(({ Letter }) => Letter === letter);
                    if (natoLetterTable == undefined) {
                        return "";
                    };
                    return natoLetterTable.NATO_Truncated;
                }
            };
            
            const controllerTableLookup = async (vatsimCallsign) => {
                const controllerTableFetch = await fetch (`Station_Codes.json`);
                const { Stations } = await controllerTableFetch.json();
                const controllerStationId = Stations.find(({ vatsim_callsign }) => vatsim_callsign === vatsimCallsign);
                if (controllerStationId) {
                    return controllerStationId;
                } else {
                    return {vatsim_callsign: vatsimCallsign, unit: vatsimCallsign, identifier: vatsimCallsign};
                };
            };
                        
            const trlCalculator = (qnh) => {
                let trl = 70;
                if (qnh < 977) {
                    trl = 85;
                } else if (qnh < 995) {
                    trl = 80;
                } else if (qnh < 1013) {
                    trl = 75;
                } else if (qnh < 1032) {
                    trl = 70;
                } else if (qnh < 1051) {
                    trl = 65;
                } else {
                    trl = 60;
                };
                return trl;
            };
            
            const runwayArrowVisibility = () => {
                document.getElementById("dep_rwy_10").style.visibility = "hidden";
                document.getElementById("dep_rwy_16").style.visibility = "hidden";
                document.getElementById("dep_rwy_28").style.visibility = "hidden";
                document.getElementById("dep_rwy_32").style.visibility = "hidden";
                document.getElementById("dep_rwy_34").style.visibility = "hidden";
                document.getElementById("arr_rwy_14").style.visibility = "hidden";
                document.getElementById("arr_rwy_16").style.visibility = "hidden";
                document.getElementById("arr_rwy_28").style.visibility = "hidden";
                document.getElementById("arr_rwy_34").style.visibility = "hidden";
                for (let i = 0; i < runwayConcept.depRwy.length; i++) {
                    if (runwayConcept.depRwy[i] == 10) {
                        document.getElementById("dep_rwy_10").style.visibility = "visible"
                    };
                    if (runwayConcept.depRwy[i] == 16) {
                        document.getElementById("dep_rwy_16").style.visibility = "visible"
                    };
                    if (runwayConcept.depRwy[i] == 28) {
                        document.getElementById("dep_rwy_28").style.visibility = "visible"
                    };
                    if (runwayConcept.depRwy[i] == 32) {
                        document.getElementById("dep_rwy_32").style.visibility = "visible"
                    };
                    if (runwayConcept.depRwy[i] == 34) {
                        document.getElementById("dep_rwy_34").style.visibility = "visible"
                    };
                };
                for (let i = 0; i < runwayConcept.arrRwy.length; i++) {
                    if (runwayConcept.arrRwy[i] == 14) {
                        document.getElementById("arr_rwy_14").style.visibility = "visible"
                    };
                    if (runwayConcept.arrRwy[i] == 16) {
                        document.getElementById("arr_rwy_16").style.visibility = "visible"
                    };
                    if (runwayConcept.arrRwy[i] == 28) {
                        document.getElementById("arr_rwy_28").style.visibility = "visible"
                    };
                    if (runwayConcept.arrRwy[i] == 34) {
                        document.getElementById("arr_rwy_34").style.visibility = "visible"
                    };
                };
            };
            
            const fetchControllerData = async () => {
                try {
                    const response = await fetch ("https://api.paganini.cloud/vatsim-data.json");
                    const { controllers } = await response.json();
                    return controllers;
                } catch (error) {
                    throw new Error(error);
                }
            };
            
            const ownStation = async () => {
                const controllerData = await fetchControllerData();
                const ownStationData = controllerData.find(({ cid }) => cid === vatsimCid);
                const ownFrequencyEl = document.getElementById("own_frequency");
                if (ownStationData) {
                    const ownCallsign = ownStationData.callsign;
                    const controllerTable = await controllerTableLookup(ownCallsign);
                    const controllerId = controllerTable.identifier;
                    ownFrequencyEl.innerText = controllerId.concat(" ", ownStationData.frequency);
                } else {
                    ownFrequencyEl.innerText = "Offline";
                }
            };
            setInterval(() => ownStation(), 29500);
            ownStation();
            
            const runwayFormatter = () => {
                let depRwy = "";
                if (runwayConcept.depRwy.length > 1) {
                    for (let i = 0; i < runwayConcept.depRwy.length - 1; i++) {
                        depRwy = depRwy.concat(String(runwayConcept.depRwy[i]),", ");
                    };
                };
                depRwy = depRwy.concat(runwayConcept.depRwy[runwayConcept.depRwy.length - 1]);
                let arrRwy = "";
                if (runwayConcept.arrRwy.length > 1) {
                    for (let i = 0; i < runwayConcept.arrRwy.length - 1; i++) {
                        arrRwy = arrRwy.concat(String(runwayConcept.arrRwy[i])," ILS, ");
                    };
                };
                arrRwy = arrRwy.concat(runwayConcept.arrRwy[runwayConcept.arrRwy.length - 1], " ILS");
                return [depRwy, arrRwy];
            };
            
            const fetchAtis = async (icao) => {
                try {
                    const response = await fetch ("https://api.paganini.cloud/vatsim-data.json");
                    const { atis } = await response.json();
                    return atis.find(({ callsign }) => callsign === `${icao.toUpperCase()}_ATIS`);
                } catch (error) {
                    throw new Error(error);
                }
            };
            
            const updateAtis = async () => {
                const depAtisFirstEl = document.getElementById("depAtisFirst");
                const depAtisRestEl = document.getElementById("depAtisRest");
                const depAtisOnAirEl = document.getElementById("dep_atis_on_air");
                const depAtisRuntimeEl = document.getElementById("dep_atis_runtime");
                const arrAtisFirstEl = document.getElementById("arrAtisFirst");
                const arrAtisRestEl = document.getElementById("arrAtisRest");
                const arrAtisOnAirEl = document.getElementById("arr_atis_on_air");
                const arrAtisRuntimeEl = document.getElementById("arr_atis_runtime");
                const transitionLevelEl = document.getElementById("TRL");
                const approachEl = document.getElementById("approach_type");
                const depRwyStatusBoxEl = document.getElementById("dep_rwy_status");
                const arrRwyStatusBoxEl = document.getElementById("arr_rwy_status");
                const atis  = await fetchAtis(apt);
                if (shownAtis === "Dep") {
                    document.getElementById("decoded_info").className = "decoded_info_dep";
                } else {
                    document.getElementById("decoded_info").className = "decoded_info_arr";                    
                }
                if (atis && atis.text_atis != null) {
                    const atisLetter = atis.atis_code;
                    const atisIdRest = await natoRest(atisLetter);
                    const date_time = new Date();
                    var UTCHour = date_time.getUTCHours().toString().padStart(2,'0');
                    var UTCMinute = date_time.getUTCMinutes().toString().padStart(2,'0');
                    depAtisFirstEl.innerText = atisLetter;
                    depAtisRestEl.innerText = atisIdRest;
                    depAtisOnAirEl.innerText = "On Air";
                    depAtisRuntimeEl.innerText = UTCHour.concat("h",UTCMinute);
                    arrAtisFirstEl.innerText = atisLetter;
                    arrAtisRestEl.innerText = atisIdRest;
                    arrAtisOnAirEl.innerText = "On Air";
                    arrAtisRuntimeEl.innerText = UTCHour.concat("h",UTCMinute);
                    const textAtis = atis.text_atis.join();
                    const trlPos = textAtis.search("TRANSITION LEVEL");
                    const trl = textAtis.slice(trlPos + 17, trlPos + 19);
                    globalTrl = Number(trl);
                    findRunwaysInAtis(textAtis.replace(/,/gi," "));
                    const arrRwy = runwayConcept.arrRwy;
                    const depRwy = runwayConcept.depRwy;
                    let approach;
                    if (arrRwy.length > 1) {
                        approach = "ARRIVALS, EXP ILS APCH, RWYS"
                        for (let i = 0; i < arrRwy.length - 1; i++) {
                            approach = approach.concat(arrRwy[i], ", ");
                        };
                        approach.concat("AND ",arrRwy[arrRwy.length - 1]);
                    } else {
                        approach = "ARRIVALS, EXP ILS APCH, RWY".concat(arrRwy[0]);
                    };
                    let departure;
                    if (depRwy.length > 1) {
                        departure = "DEPARTURE RWYS"
                        for (let i = 0; i < depRwy.length - 1; i++) {
                            departure = departure.concat(depRwy[i], ", ");
                        };
                        departure.concat("AND ",depRwy[depRwy.length - 1]);
                    } else {
                        departure = "DEPARTURE RWY".departure(depRwy[0]);
                    };
                    runwayArrowVisibility();
                    const runwayConfigForStatusInd = runwayFormatter();
                    const depRwyForStatus = runwayConfigForStatusInd[0];
                    const arrRwyForStatus = runwayConfigForStatusInd[1];
                    depRwyStatusBoxEl.innerText = depRwyForStatus;
                    arrRwyStatusBoxEl.innerText = arrRwyForStatus;
                    transitionLevelEl.innerText = trl;
                    if (shownAtis == "Dep") {
                        approachEl.innerText = departure;
                    } else {
                        approachEl.innerText = approach;
                    };
                    if (runwayConcept.isNDVO) {
                        document.getElementById("ndvo_status").className = "status_box_active";
                    } else {
                        document.getElementById("ndvo_status").className = "status_box_inactive";
                    };
                    if (globalWeather.ceiling < 1500 || globalWeather.vis < 5000) {
                        document.getElementById("imc_status").className = "status_box_active";
                    } else {
                        document.getElementById("imc_status").className = "status_box_inactive";
                    };
                    if (globalWeather.rvr < 550 || globalWeather.ceiling < 200) {
                         document.getElementById("lvp_status").className = "status_box_active";
                    } else {
                        document.getElementById("lvp_status").className = "status_box_inactive";
                    };
                    if (globalWeather.qnh > 1012) {
                        transitionLevelEl.style = "color: lightgreen";
                    } else {
                        transitionLevelEl.style = "color: #EFE26A"
                    };
                } else {
                    noAtisRunwayConceptDeterminer();
                    depAtisFirstEl.innerText = "";
                    depAtisRestEl.innerText = "";
                    depAtisOnAirEl.innerText = "Offline";
                    depAtisRuntimeEl.innerText = "";
                    arrAtisFirstEl.innerText = "";
                    arrAtisRestEl.innerText = "";
                    arrAtisOnAirEl.innerText = "Offline";
                    arrAtisRuntimeEl.innerText = "";
                    transitionLevelEl.innerText = trlCalculator(globalWeather.qnh);
                    const arrRwy = runwayConcept.arrRwy;
                    const depRwy = runwayConcept.depRwy;
                    let approach;
                    if (arrRwy.length > 1) {
                        approach = "ARRIVALS, EXP ILS APCH, RWYS"
                        for (let i = 0; i < arrRwy.length - 1; i++) {
                            approach = approach.concat(arrRwy[i], ", ");
                        };
                        approach = approach.concat("AND ",arrRwy[arrRwy.length - 1]);
                    } else {
                        approach = "ARRIVALS, EXP ILS APCH, RWY".concat(arrRwy[0]);
                    };
                    let departure;
                    if (depRwy.length > 1) {
                        departure = "DEPARTURE RWYS"
                        for (let i = 0; i < depRwy.length - 1; i++) {
                            departure = departure.concat(depRwy[i], ", ");
                        };
                        departure = departure.concat("AND ",depRwy[depRwy.length - 1]);
                    } else {
                        departure = "DEPARTURE RWY".departure(depRwy[0]);
                    };
                    if (shownAtis == "Dep") {
                        approachEl.innerText = departure;
                    } else {
                        approachEl.innerText = approach;
                    };
                    console.log(depRwy, depRwy.length, departure, approach, shownAtis)
                    approachEl.innerText = "ARRIVALS, EXP ILS APCH, RWY".concat(String(runwayConcept.arrRwy));
                    runwayArrowVisibility();
                    const runwayConfigForStatusInd = runwayFormatter();
                    const depRwyForStatus = runwayConfigForStatusInd[0];
                    const arrRwyForStatus = runwayConfigForStatusInd[1];
                    depRwyStatusBoxEl.innerText = depRwyForStatus;
                    arrRwyStatusBoxEl.innerText = arrRwyForStatus;
                    if (runwayConcept.isNDVO) {
                        document.getElementById("ndvo_status").className = "status_box_active";
                    } else {
                        document.getElementById("ndvo_status").className = "status_box_inactive";
                    };
                    if (globalWeather.ceiling < 1500 || globalWeather.vis < 5000) {
                        document.getElementById("imc_status").className = "status_box_active";
                    } else {
                        document.getElementById("imc_status").className = "status_box_inactive";
                    };
                    if (globalWeather.rvr < 550 || globalWeather.ceiling < 200) {
                         document.getElementById("lvp_status").className = "status_box_active";
                    } else {
                        document.getElementById("lvp_status").className = "status_box_inactive";
                    };
                    if (globalWeather.qnh > 1012) {
                        transitionLevelEl.style = "color: lightgreen";
                    } else {
                        transitionLevelEl.style = "color: #EFE26A"
                    };
                };
            }
            setInterval(() => updateAtis(), 29500);
            updateAtis(); 
            
            const fetchSwissMetNetData = async () => {
                try {
                    const response = await fetch ("https://data.geo.admin.ch/ch.meteoschweiz.messwerte-aktuell/VQHA80.csv", {headers: {'Content-Type': 'text/plain'}});
                    const raw = await response.text();
                    const lines = raw.split(/\r?\n/);
                    const SwissMetDataArray = lines.map((line) => line.split(";"));
                    return SwissMetDataArray
                } catch (error) {
                    throw new Error(error);
                };
            };
            
            const toKts = (kph) => {
                return Math.round(Number(kph) / 1.852);
            };
            
            const readSwissMetNetData = async () => {
                const data = await fetchSwissMetNetData();
                const hoernliData = data.filter(([station]) => station === "HOE")[0];
                const [,hoernliTime,hoernliTemp,,,,,hoernliDP,hoernliWindDir,hoernliWindSpeedKph,hoernliWindGustKph] = hoernliData;
                const laegernData = data.filter(([station]) => station === "LAE")[0];
                const [,laegernTime,laegernTemp,,,,,laegernDP,laegernWindDir,laegernWindSpeedKph,laegernWindGustKph] = laegernData;
                const klotenData = data.filter(([station]) => station === "KLO")[0];
                const [,klotenTime,klotenTemp,,,,,klotenDP,klotenWindDir,klotenWindSpeedKph,klotenWindGustKph] = klotenData;
                const hoernliTimeEl = document.getElementById("hoernliTime");
                const hoernliWindEl = document.getElementById("hoernliWind");
                const hoernliGustEl = document.getElementById("hoernliGust");
                const hoernliTempEl = document.getElementById("hoernliTemp");                
                const laegernTimeEl = document.getElementById("laegernTime");
                const laegernWindEl = document.getElementById("laegernWind");
                const laegernGustEl = document.getElementById("laegernGust");
                const laegernTempEl = document.getElementById("laegernTemp");
                const wind14El = document.getElementById("Wind_Rwy14");                
                const wind10El = document.getElementById("Wind_Rwy10");
                const wind32El = document.getElementById("Wind_Rwy32");
                const hoernliHours = hoernliTime.slice(-4,-2);
                const hoernliMinutes = hoernliTime.slice(-2);
                const hoernliTimeFormatted = hoernliHours.concat("h",hoernliMinutes);
                const hoernliWindSpeedKt = String(toKts(hoernliWindSpeedKph)).padStart(3,0);
                const hoernliWindFormatted = String(Math.round(Number(hoernliWindDir) / 10) * 10).padStart(3,0).concat("/", hoernliWindSpeedKt);
                const hoernliGustFormatted = String(toKts(hoernliWindGustKph)).padStart(3,0);
                const hoernliTempDp = numberSigner(Math.round(hoernliTemp),2).concat("/",numberSigner(Math.round(hoernliDP),2));
                const laegernHours = laegernTime.slice(-4,-2);
                const laegernMinutes = laegernTime.slice(-2);
                const laegernTimeFormatted = laegernHours.concat("h",laegernMinutes);
                const laegernWindSpeedKt = String(toKts(laegernWindSpeedKph)).padStart(3,0);
                const laegernWindFormatted = String(Math.round(Number(laegernWindDir) / 10) * 10).padStart(3,0).concat("/", laegernWindSpeedKt);
                const laegernGustFormatted = String(toKts(laegernWindGustKph)).padStart(3,0);
                const laegernTempDp = numberSigner(Math.round(laegernTemp),2).concat("/",numberSigner(Math.round(laegernDP),2));                
                const klotenWindSpeedKt = String(toKts(klotenWindSpeedKph)).padStart(2,0);
                const klotenWindFormatted = String(Math.round(Number(klotenWindDir) / 10) * 10).padStart(3,0).concat("/", klotenWindSpeedKt);
                hoernliTimeEl.innerText = hoernliTimeFormatted;
                hoernliWindEl.innerText = hoernliWindFormatted;
                hoernliGustEl.innerText = hoernliGustFormatted;
                hoernliTempEl.innerText = hoernliTempDp;
                laegernTimeEl.innerText = laegernTimeFormatted;
                laegernWindEl.innerText = laegernWindFormatted;
                laegernGustEl.innerText = laegernGustFormatted;
                laegernTempEl.innerText = laegernTempDp;
                wind10El.innerText = klotenWindFormatted;
                wind14El.innerText = klotenWindFormatted;
                wind32El.innerText = klotenWindFormatted;
                const arrow_image_Rwy14 = document.getElementById("Wind_Arrow_Rwy14");
                arrow_image_Rwy14.style.transform = `rotate(${(Math.round(Number(klotenWindDir) / 10) * 10)-180}deg)`;
                const arrow_image_Rwy10 = document.getElementById("Wind_Arrow_Rwy10");
                arrow_image_Rwy10.style.transform = `rotate(${(Math.round(Number(klotenWindDir) / 10) * 10)-180}deg)`;
                const arrow_image_Rwy32 = document.getElementById("Wind_Arrow_Rwy32");
                arrow_image_Rwy32.style.transform = `rotate(${(Math.round(Number(klotenWindDir) / 10) * 10)-180}deg)`;
            };
            setInterval(() => readSwissMetNetData(), 60000);
            readSwissMetNetData();
            
        </script>
    </body>
</html> 